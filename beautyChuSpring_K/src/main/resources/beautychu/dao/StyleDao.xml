<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 	
	int styleNo;
	String email;
	String people;
	String gender;
	String styleSort;
	String styleLength;
	String styleName;
	int price;
	String styleIntro;
	String stylePhotoNo;
	String stylePhotoUrl;
	MultipartFile photofile;
	List<?> photoList; -->

<mapper namespace="beautychu.dao.StyleDao">

  <!-- 객체의 컬럼과 프로퍼티를 연결한다. -->
  <resultMap type="Style" id="styleMap">
  	<!-- PK 컬럼은 id 태그를 사용하여 지정한다. -->
    <id column="STYLENO" property="styleNo"/>
    <result column="EMAIL" property="email"/>
    <result column="PEOPLE" property="people"/>
    <result column="GENDER" property="gender"/>
    <result column="STYLESORT" property="styleSort"/>
    <result column="STYLELENGTH" property="styleLength"/>
    <result column="STYLENAME" property="styleName"/>
    <result column="PRICE" property="price"/>
    <result column="STYLEINTRO" property="styleIntro"/>
    <!-- <result column="PHOTOFILE" property="photofile"/>
    <result column="PHOTOLIST" property="photoList"/>     -->
  </resultMap>
  
  <!-- 객체의 컬럼과 프로퍼티를 연결한다. -->
  <resultMap type="StylePhoto" id="stylePhotoMap">
  	<!-- PK 컬럼은 id 태그를 사용하여 지정한다. -->
    <id column="STYLEPHOTONO" property="stylePhotoNo"/>
    <result column="STYLENO" property="styleNo"/>
    <result column="STYLEPHOTOURL" property="stylePhotoUrl"/>
  </resultMap>
  
  <resultMap type="StyleGrid" id="styleGridMap">
    <id column="STYLENO" property="styleNo"/>
    <result column="STYLENAME" property="styleName"/>
    <result column="STYLEPHOTOURL" property="stylePhotoUrl"/>
  </resultMap>
  
  <resultMap type="MainStyle" id="mainStyleMap">
    <result column="STYLEPHOTOURL" property="stylePhotoUrl"/>
    <result column="STYLENAME" property="styleName"/>
    <result column="SHOPNAME" property="shopName"/>
    <result column="STYLENO" property="styleNo"/>
  </resultMap>
  
  <!-- <select id="getList" parameterType="map" resultMap="styleMap">
    SELECT STYLENO,PEOPLE,GENDER,STYLESORT,STYLELENGTH,STYLENAME,STYLEINTRO,PRICE,EMAIL 
	FROM STYLE
  </select> -->
  <!-- <select id="getList" parameterType="map" resultMap="styleMap">
    SELECT S1.STYLENO, S2.STYLENO, STYLEPHOTONO, STYLEPHOTOURL, PEOPLE, GENDER, STYLESORT, STYLELENGTH,STYLENAME,PRICE,STYLEINTRO
	FROM STYLE S1, STYLEPHOTO S2
	WHERE S1.STYLENO = S2.STYLENO;
  </select> -->
  
  <select id="getList" parameterType="map" resultMap="styleGridMap">
    SELECT T1.STYLENO, T1.STYLENAME, T2.STYLEPHOTOURL 
    FROM STYLE T1
    JOIN
    (SELECT STYLENO,STYLEPHOTOURL,STYLEPHOTONO FROM STYLEPHOTO GROUP BY STYLENO) T2
    USING(STYLENO)
    ORDER BY STYLENO
  </select>
  
  <select id="getMainStyleList" parameterType="map" resultMap="mainStyleMap">
    SELECT S3.STYLEPHOTOURL, S1.STYLENAME, S2.SHOPNAME, S1.STYLENO
    FROM STYLE S1
    LEFT JOIN SHOP S2
    ON S1.EMAIL = S2.EMAIL
    LEFT JOIN STYLEPHOTO S3
    ON S1.STYLENO = S3.STYLENO
	GROUP BY S1.STYLENO
	ORDER BY S1.STYLENO DESC
	LIMIT 20
  </select>
  
  <!-- <select id="getMainShopList" parameterType="map" resultMap="mainShopMap">
    SELECT S2.EMAIL,S2.SHOPNAME,S2.SHOPADDR,S2.SHOPTEL,S3.SHOPPHOTOURL
      FROM STYLE S1
      LEFT JOIN SHOP S2
      ON S1.EMAIL = S2.EMAIL
      LEFT JOIN SHOPPHOTO S3
      ON S2.EMAIL = S3.EMAIL
      WHERE S1.STYLENO = #{value}
      LIMIT 1
  </select> -->
  
  <insert id="insertStyle" parameterType="Style" useGeneratedKeys="true" keyColumn="STYLENO" keyProperty="styleNo">
    INSERT INTO STYLE (EMAIL,PEOPLE,GENDER,STYLESORT,STYLELENGTH,STYLENAME,PRICE,STYLEINTRO)
    VALUES (#{email},#{people},#{gender},#{styleSort},#{styleLength},#{styleName},#{price},#{styleIntro});
  </insert>
  
  <insert id="insertStylePhoto" parameterType="Style">
  	INSERT INTO STYLEPHOTO (STYLENO, STYLEPHOTOURL)
    VALUES (#{styleNo}, #{stylePhotoUrl});
  </insert>
  
  
  
  <!-- <update id="updateStyle" parameterType="Style" >
    UPDATE STYLE A 
    LEFT JOIN STYLEPHOTO B
    ON A.STYLENO = B.STYLENO
    SET STYLESORT,STYLELENGTH,STYLENAME,PRICE,STYLEINTRO, STYLEPHOTO
    VALUES (#{stylePhotoUrl});
    FROM STYLE T1, STYLEPHOTO T2
    WHERE T1.STYLENO = T2.STYLENO;
  </update> -->
  
  
</mapper>



















